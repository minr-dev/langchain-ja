# Prediction Guard | Prediction Guard

ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€LangChainå†…ã§Prediction Guardã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜Žã—ã¦ã„ã¾ã™ã€‚å†…å®¹ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ãã—ã¦ç‰¹å®šã®Prediction Guardãƒ©ãƒƒãƒ‘ãƒ¼ã¸ã®å‚ç…§ã¨ã„ã†2ã¤ã®ãƒ‘ãƒ¼ãƒˆã«åˆ†ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

> This page covers how to use the Prediction Guard ecosystem within LangChain.
> It is broken into two parts: installation and setup, and then references to specific Prediction Guard wrappers.

## Installation and Setup | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

* `pip install predictionguard`ã§Python SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„
  > Install the Python SDK with `pip install predictionguard`
* Prediction Guardã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ï¼ˆ[ã“ã¡ã‚‰](https://docs.predictionguard.com/)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æ–¹æ³•ã§ï¼‰ã€ãã‚Œã‚’ç’°å¢ƒå¤‰æ•°ï¼ˆ`PREDICTIONGUARD_TOKEN`ï¼‰ã¨ã—ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚
  > Get a Prediction Guard access token (as described [here](https://docs.predictionguard.com/)) and set it as an environment variable (`PREDICTIONGUARD_TOKEN`)

## LLM Wrapper | LLMãƒ©ãƒƒãƒ‘ãƒ¼

Prediction Guard LLMãƒ©ãƒƒãƒ‘ãƒ¼ãŒå­˜åœ¨ã—ã€æ¬¡ã®æ–¹æ³•ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™

> There exists a Prediction Guard LLM wrapper, which you can access with

```python
from langchain.llms import PredictionGuard
```

LLMã‚’åˆæœŸåŒ–ã™ã‚‹éš›ã«ã€Prediction Guardãƒ¢ãƒ‡ãƒ«ã®åå‰ã‚’å¼•æ•°ã¨ã—ã¦æä¾›ã§ãã¾ã™ï¼š

> You can provide the name of the Prediction Guard model as an argument when initializing the LLM:

```python
pgllm = PredictionGuard(model="MPT-7B-Instruct")
```

ã¾ãŸã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›´æŽ¥å¼•æ•°ã¨ã—ã¦æä¾›ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

> You can also provide your access token directly as an argument:

```python
pgllm = PredictionGuard(model="MPT-7B-Instruct", token="<your access token>")
```

æœ€å¾Œã«ã€ã€Œoutputã€ã¨ã„ã†å¼•æ•°ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€LLMã®å‡ºåŠ›ã‚’æ§‹é€ åŒ–ã¾ãŸã¯åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

> Finally, you can provide an "output" argument that is used to structure/ control the output of the LLM:

```python
pgllm = PredictionGuard(model="MPT-7B-Instruct", output={"type": "boolean"})
```

## Example usage | ä½¿ç”¨ä¾‹

åˆ¶å¾¡ã•ã‚ŒãŸã¾ãŸã¯ã‚¬ãƒ¼ãƒ‰ã•ã‚ŒãŸLLMãƒ©ãƒƒãƒ‘ãƒ¼ã®åŸºæœ¬çš„ãªä½¿ç”¨æ³•ï¼š

> Basic usage of the controlled or guarded LLM wrapper:

```python
import os

import predictionguard as pg
from langchain.llms import PredictionGuard
from langchain.prompts import PromptTemplate
from langchain.chains import LLMChain

# Your Prediction Guard API key. Get one at predictionguard.com
os.environ["PREDICTIONGUARD_TOKEN"] = "<your Prediction Guard access token>"

# Define a prompt template
template = """Respond to the following query based on the context.

Context: EVERY comment, DM + email suggestion has led us to this EXCITING announcement! ðŸŽ‰ We have officially added TWO new candle subscription box options! ðŸ“¦
Exclusive Candle Box - $80 
Monthly Candle Box - $45 (NEW!)
Scent of The Month Box - $28 (NEW!)
Head to stories to get ALL the deets on each box! ðŸ‘† BONUS: Save 50% on your first box with code 50OFF! ðŸŽ‰

Query: {query}

Result: """
prompt = PromptTemplate(template=template, input_variables=["query"])

# With "guarding" or controlling the output of the LLM. See the 
# Prediction Guard docs (https://docs.predictionguard.com) to learn how to 
# control the output with integer, float, boolean, JSON, and other types and
# structures.
pgllm = PredictionGuard(model="MPT-7B-Instruct", 
                        output={
                                "type": "categorical",
                                "categories": [
                                    "product announcement", 
                                    "apology", 
                                    "relational"
                                    ]
                                })
pgllm(prompt.format(query="What kind of post is this?"))
```

Prediction Guardãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½¿ã£ãŸåŸºæœ¬çš„ãªLLMãƒã‚§ãƒ¼ãƒ³:

> Basic LLM Chaining with the Prediction Guard wrapper:

```python
import os

from langchain.prompts import PromptTemplate
from langchain.chains import LLMChain
from langchain.llms import PredictionGuard

# Optional, add your OpenAI API Key. This is optional, as Prediction Guard allows
# you to access all the latest open access models (see https://docs.predictionguard.com)
os.environ["OPENAI_API_KEY"] = "<your OpenAI api key>"

# Your Prediction Guard API key. Get one at predictionguard.com
os.environ["PREDICTIONGUARD_TOKEN"] = "<your Prediction Guard access token>"

pgllm = PredictionGuard(model="OpenAI-gpt-3.5-turbo-instruct")

template = """Question: {question}

Answer: Let's think step by step."""
prompt = PromptTemplate(template=template, input_variables=["question"])
llm_chain = LLMChain(prompt=prompt, llm=pgllm, verbose=True)

question = "What NFL team won the Super Bowl in the year Justin Beiber was born?"

llm_chain.predict(question=question)
```
